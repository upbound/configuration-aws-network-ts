apiVersion: platform.upbound.io/v1
kind: BasicApp
metadata:
  name: example-full
  namespace: default
spec:
  parameters:
    name: my-app
    image:
      repository: nginx
      pullPolicy: IfNotPresent
      tag: "1.21"

    serviceAccount:
      enabled: true
      name: "my-service-account"
      annotations:
        eks.amazonaws.com/role-arn: "arn:aws:iam::123456789012:role/my-role"

    pod:
      replicaCount: 2
      podSecurityContext:
        fsGroup: 2000
      securityContext:
        capabilities:
          drop:
            - ALL
        readOnlyRootFilesystem: true
        runAsNonRoot: true
        runAsUser: 1000
      resources:
        limits:
          cpu: 500m
          memory: 512Mi
        requests:
          cpu: 100m
          memory: 128Mi

    service:
      enabled: true
      type: ClusterIP
      port: 80

    ingress:
      enabled: true
      className: "nginx"
      annotations:
        kubernetes.io/ingress.class: nginx
        kubernetes.io/tls-acme: "true"
        cert-manager.io/cluster-issuer: "letsencrypt-prod"
      hosts:
        - host: chart-example.local
          paths:
            - path: /
              pathType: ImplementationSpecific
        - host: api.example.com
          paths:
            - path: /api
              pathType: Prefix
